{"/home/yu23ki14/apps/henkaku/nft-karuta-backend/server/test/todo-management/todo.tests.ts":{"path":"/home/yu23ki14/apps/henkaku/nft-karuta-backend/server/test/todo-management/todo.tests.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":14},"end":{"line":3,"column":38}},"2":{"start":{"line":4,"column":15},"end":{"line":4,"column":30}},"3":{"start":{"line":5,"column":26},"end":{"line":5,"column":78}},"4":{"start":{"line":6,"column":27},"end":{"line":6,"column":54}},"5":{"start":{"line":7,"column":15},"end":{"line":7,"column":30}},"6":{"start":{"line":8,"column":26},"end":{"line":15,"column":1}},"7":{"start":{"line":9,"column":12},"end":{"line":9,"column":13}},"8":{"start":{"line":10,"column":4},"end":{"line":14,"column":6}},"9":{"start":{"line":11,"column":8},"end":{"line":13,"column":9}},"10":{"start":{"line":12,"column":12},"end":{"line":12,"column":19}},"11":{"start":{"line":16,"column":0},"end":{"line":254,"column":3}},"12":{"start":{"line":18,"column":4},"end":{"line":32,"column":7}},"13":{"start":{"line":19,"column":28},"end":{"line":19,"column":54}},"14":{"start":{"line":20,"column":8},"end":{"line":20,"column":48}},"15":{"start":{"line":21,"column":8},"end":{"line":21,"column":72}},"16":{"start":{"line":22,"column":8},"end":{"line":24,"column":11}},"17":{"start":{"line":25,"column":8},"end":{"line":31,"column":11}},"18":{"start":{"line":26,"column":25},"end":{"line":26,"column":50}},"19":{"start":{"line":27,"column":12},"end":{"line":27,"column":76}},"20":{"start":{"line":28,"column":12},"end":{"line":28,"column":46}},"21":{"start":{"line":29,"column":12},"end":{"line":29,"column":81}},"22":{"start":{"line":30,"column":12},"end":{"line":30,"column":51}},"23":{"start":{"line":33,"column":4},"end":{"line":37,"column":7}},"24":{"start":{"line":34,"column":8},"end":{"line":34,"column":27}},"25":{"start":{"line":35,"column":8},"end":{"line":35,"column":28}},"26":{"start":{"line":36,"column":8},"end":{"line":36,"column":33}},"27":{"start":{"line":38,"column":4},"end":{"line":88,"column":7}},"28":{"start":{"line":39,"column":8},"end":{"line":63,"column":11}},"29":{"start":{"line":40,"column":32},"end":{"line":40,"column":58}},"30":{"start":{"line":41,"column":12},"end":{"line":56,"column":15}},"31":{"start":{"line":45,"column":16},"end":{"line":47,"column":17}},"32":{"start":{"line":46,"column":20},"end":{"line":46,"column":64}},"33":{"start":{"line":48,"column":16},"end":{"line":48,"column":63}},"34":{"start":{"line":49,"column":37},"end":{"line":49,"column":76}},"35":{"start":{"line":50,"column":16},"end":{"line":54,"column":19}},"36":{"start":{"line":55,"column":16},"end":{"line":55,"column":30}},"37":{"start":{"line":57,"column":12},"end":{"line":62,"column":15}},"38":{"start":{"line":58,"column":16},"end":{"line":58,"column":62}},"39":{"start":{"line":59,"column":16},"end":{"line":59,"column":69}},"40":{"start":{"line":60,"column":16},"end":{"line":60,"column":65}},"41":{"start":{"line":61,"column":16},"end":{"line":61,"column":30}},"42":{"start":{"line":64,"column":8},"end":{"line":87,"column":11}},"43":{"start":{"line":65,"column":35},"end":{"line":68,"column":13}},"44":{"start":{"line":70,"column":12},"end":{"line":83,"column":15}},"45":{"start":{"line":71,"column":16},"end":{"line":73,"column":17}},"46":{"start":{"line":72,"column":20},"end":{"line":72,"column":64}},"47":{"start":{"line":74,"column":16},"end":{"line":74,"column":72}},"48":{"start":{"line":75,"column":16},"end":{"line":81,"column":19}},"49":{"start":{"line":82,"column":16},"end":{"line":82,"column":23}},"50":{"start":{"line":84,"column":12},"end":{"line":86,"column":15}},"51":{"start":{"line":85,"column":16},"end":{"line":85,"column":53}},"52":{"start":{"line":89,"column":4},"end":{"line":128,"column":7}},"53":{"start":{"line":90,"column":8},"end":{"line":105,"column":11}},"54":{"start":{"line":91,"column":12},"end":{"line":95,"column":15}},"55":{"start":{"line":96,"column":12},"end":{"line":104,"column":15}},"56":{"start":{"line":97,"column":16},"end":{"line":99,"column":17}},"57":{"start":{"line":98,"column":20},"end":{"line":98,"column":64}},"58":{"start":{"line":100,"column":16},"end":{"line":100,"column":95}},"59":{"start":{"line":101,"column":16},"end":{"line":101,"column":73}},"60":{"start":{"line":102,"column":16},"end":{"line":102,"column":68}},"61":{"start":{"line":103,"column":16},"end":{"line":103,"column":23}},"62":{"start":{"line":106,"column":8},"end":{"line":116,"column":11}},"63":{"start":{"line":107,"column":12},"end":{"line":115,"column":15}},"64":{"start":{"line":108,"column":16},"end":{"line":114,"column":17}},"65":{"start":{"line":109,"column":20},"end":{"line":109,"column":77}},"66":{"start":{"line":110,"column":20},"end":{"line":110,"column":27}},"67":{"start":{"line":113,"column":20},"end":{"line":113,"column":57}},"68":{"start":{"line":117,"column":8},"end":{"line":127,"column":11}},"69":{"start":{"line":118,"column":12},"end":{"line":126,"column":15}},"70":{"start":{"line":119,"column":16},"end":{"line":125,"column":17}},"71":{"start":{"line":120,"column":20},"end":{"line":120,"column":77}},"72":{"start":{"line":121,"column":20},"end":{"line":121,"column":27}},"73":{"start":{"line":124,"column":20},"end":{"line":124,"column":57}},"74":{"start":{"line":129,"column":4},"end":{"line":186,"column":7}},"75":{"start":{"line":130,"column":8},"end":{"line":155,"column":11}},"76":{"start":{"line":131,"column":32},"end":{"line":131,"column":58}},"77":{"start":{"line":132,"column":12},"end":{"line":136,"column":15}},"78":{"start":{"line":137,"column":12},"end":{"line":149,"column":15}},"79":{"start":{"line":142,"column":37},"end":{"line":142,"column":106}},"80":{"start":{"line":143,"column":16},"end":{"line":147,"column":19}},"81":{"start":{"line":148,"column":16},"end":{"line":148,"column":30}},"82":{"start":{"line":150,"column":12},"end":{"line":154,"column":15}},"83":{"start":{"line":151,"column":16},"end":{"line":151,"column":72}},"84":{"start":{"line":152,"column":16},"end":{"line":152,"column":64}},"85":{"start":{"line":153,"column":16},"end":{"line":153,"column":30}},"86":{"start":{"line":156,"column":8},"end":{"line":185,"column":11}},"87":{"start":{"line":157,"column":35},"end":{"line":161,"column":13}},"88":{"start":{"line":163,"column":12},"end":{"line":181,"column":15}},"89":{"start":{"line":164,"column":16},"end":{"line":166,"column":17}},"90":{"start":{"line":165,"column":20},"end":{"line":165,"column":64}},"91":{"start":{"line":167,"column":16},"end":{"line":167,"column":72}},"92":{"start":{"line":168,"column":16},"end":{"line":179,"column":19}},"93":{"start":{"line":180,"column":16},"end":{"line":180,"column":23}},"94":{"start":{"line":182,"column":12},"end":{"line":184,"column":15}},"95":{"start":{"line":183,"column":16},"end":{"line":183,"column":53}},"96":{"start":{"line":187,"column":4},"end":{"line":221,"column":7}},"97":{"start":{"line":188,"column":8},"end":{"line":208,"column":11}},"98":{"start":{"line":189,"column":32},"end":{"line":189,"column":58}},"99":{"start":{"line":190,"column":23},"end":{"line":190,"column":61}},"100":{"start":{"line":191,"column":12},"end":{"line":195,"column":15}},"101":{"start":{"line":196,"column":12},"end":{"line":203,"column":15}},"102":{"start":{"line":197,"column":16},"end":{"line":202,"column":17}},"103":{"start":{"line":198,"column":20},"end":{"line":198,"column":54}},"104":{"start":{"line":201,"column":20},"end":{"line":201,"column":34}},"105":{"start":{"line":204,"column":12},"end":{"line":207,"column":15}},"106":{"start":{"line":205,"column":16},"end":{"line":205,"column":86}},"107":{"start":{"line":206,"column":16},"end":{"line":206,"column":30}},"108":{"start":{"line":209,"column":8},"end":{"line":220,"column":11}},"109":{"start":{"line":210,"column":12},"end":{"line":216,"column":15}},"110":{"start":{"line":211,"column":16},"end":{"line":213,"column":17}},"111":{"start":{"line":212,"column":20},"end":{"line":212,"column":64}},"112":{"start":{"line":214,"column":16},"end":{"line":214,"column":73}},"113":{"start":{"line":215,"column":16},"end":{"line":215,"column":23}},"114":{"start":{"line":217,"column":12},"end":{"line":219,"column":15}},"115":{"start":{"line":218,"column":16},"end":{"line":218,"column":53}},"116":{"start":{"line":222,"column":4},"end":{"line":253,"column":7}},"117":{"start":{"line":223,"column":8},"end":{"line":252,"column":11}},"118":{"start":{"line":224,"column":12},"end":{"line":228,"column":15}},"119":{"start":{"line":229,"column":12},"end":{"line":233,"column":15}},"120":{"start":{"line":234,"column":12},"end":{"line":251,"column":15}},"121":{"start":{"line":235,"column":16},"end":{"line":237,"column":17}},"122":{"start":{"line":236,"column":20},"end":{"line":236,"column":64}},"123":{"start":{"line":238,"column":16},"end":{"line":249,"column":19}},"124":{"start":{"line":250,"column":16},"end":{"line":250,"column":23}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":8,"column":26},"end":{"line":8,"column":27}},"loc":{"start":{"line":8,"column":43},"end":{"line":15,"column":1}},"line":8},"1":{"name":"(anonymous_1)","decl":{"start":{"line":10,"column":11},"end":{"line":10,"column":12}},"loc":{"start":{"line":10,"column":17},"end":{"line":14,"column":5}},"line":10},"2":{"name":"(anonymous_2)","decl":{"start":{"line":16,"column":28},"end":{"line":16,"column":29}},"loc":{"start":{"line":16,"column":34},"end":{"line":254,"column":1}},"line":16},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":15},"end":{"line":18,"column":16}},"loc":{"start":{"line":18,"column":25},"end":{"line":32,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":25,"column":26},"end":{"line":25,"column":27}},"loc":{"start":{"line":25,"column":32},"end":{"line":31,"column":9}},"line":25},"5":{"name":"(anonymous_5)","decl":{"start":{"line":33,"column":14},"end":{"line":33,"column":15}},"loc":{"start":{"line":33,"column":20},"end":{"line":37,"column":5}},"line":33},"6":{"name":"(anonymous_6)","decl":{"start":{"line":38,"column":28},"end":{"line":38,"column":29}},"loc":{"start":{"line":38,"column":34},"end":{"line":88,"column":5}},"line":38},"7":{"name":"(anonymous_7)","decl":{"start":{"line":39,"column":42},"end":{"line":39,"column":43}},"loc":{"start":{"line":39,"column":52},"end":{"line":63,"column":9}},"line":39},"8":{"name":"(anonymous_8)","decl":{"start":{"line":44,"column":15},"end":{"line":44,"column":16}},"loc":{"start":{"line":44,"column":30},"end":{"line":56,"column":13}},"line":44},"9":{"name":"(anonymous_9)","decl":{"start":{"line":57,"column":43},"end":{"line":57,"column":44}},"loc":{"start":{"line":57,"column":53},"end":{"line":62,"column":13}},"line":57},"10":{"name":"(anonymous_10)","decl":{"start":{"line":64,"column":49},"end":{"line":64,"column":50}},"loc":{"start":{"line":64,"column":59},"end":{"line":87,"column":9}},"line":64},"11":{"name":"(anonymous_11)","decl":{"start":{"line":70,"column":55},"end":{"line":70,"column":56}},"loc":{"start":{"line":70,"column":64},"end":{"line":83,"column":13}},"line":70},"12":{"name":"(anonymous_12)","decl":{"start":{"line":84,"column":43},"end":{"line":84,"column":44}},"loc":{"start":{"line":84,"column":49},"end":{"line":86,"column":13}},"line":84},"13":{"name":"(anonymous_13)","decl":{"start":{"line":89,"column":26},"end":{"line":89,"column":27}},"loc":{"start":{"line":89,"column":32},"end":{"line":128,"column":5}},"line":89},"14":{"name":"(anonymous_14)","decl":{"start":{"line":90,"column":42},"end":{"line":90,"column":43}},"loc":{"start":{"line":90,"column":52},"end":{"line":105,"column":9}},"line":90},"15":{"name":"(anonymous_15)","decl":{"start":{"line":96,"column":77},"end":{"line":96,"column":78}},"loc":{"start":{"line":96,"column":86},"end":{"line":104,"column":13}},"line":96},"16":{"name":"(anonymous_16)","decl":{"start":{"line":106,"column":45},"end":{"line":106,"column":46}},"loc":{"start":{"line":106,"column":55},"end":{"line":116,"column":9}},"line":106},"17":{"name":"(anonymous_17)","decl":{"start":{"line":107,"column":44},"end":{"line":107,"column":45}},"loc":{"start":{"line":107,"column":53},"end":{"line":115,"column":13}},"line":107},"18":{"name":"(anonymous_18)","decl":{"start":{"line":117,"column":49},"end":{"line":117,"column":50}},"loc":{"start":{"line":117,"column":59},"end":{"line":127,"column":9}},"line":117},"19":{"name":"(anonymous_19)","decl":{"start":{"line":118,"column":77},"end":{"line":118,"column":78}},"loc":{"start":{"line":118,"column":86},"end":{"line":126,"column":13}},"line":118},"20":{"name":"(anonymous_20)","decl":{"start":{"line":129,"column":28},"end":{"line":129,"column":29}},"loc":{"start":{"line":129,"column":34},"end":{"line":186,"column":5}},"line":129},"21":{"name":"(anonymous_21)","decl":{"start":{"line":130,"column":42},"end":{"line":130,"column":43}},"loc":{"start":{"line":130,"column":52},"end":{"line":155,"column":9}},"line":130},"22":{"name":"(anonymous_22)","decl":{"start":{"line":141,"column":15},"end":{"line":141,"column":16}},"loc":{"start":{"line":141,"column":27},"end":{"line":149,"column":13}},"line":141},"23":{"name":"(anonymous_23)","decl":{"start":{"line":150,"column":43},"end":{"line":150,"column":44}},"loc":{"start":{"line":150,"column":53},"end":{"line":154,"column":13}},"line":150},"24":{"name":"(anonymous_24)","decl":{"start":{"line":156,"column":49},"end":{"line":156,"column":50}},"loc":{"start":{"line":156,"column":59},"end":{"line":185,"column":9}},"line":156},"25":{"name":"(anonymous_25)","decl":{"start":{"line":163,"column":55},"end":{"line":163,"column":56}},"loc":{"start":{"line":163,"column":64},"end":{"line":181,"column":13}},"line":163},"26":{"name":"(anonymous_26)","decl":{"start":{"line":182,"column":43},"end":{"line":182,"column":44}},"loc":{"start":{"line":182,"column":49},"end":{"line":184,"column":13}},"line":182},"27":{"name":"(anonymous_27)","decl":{"start":{"line":187,"column":28},"end":{"line":187,"column":29}},"loc":{"start":{"line":187,"column":34},"end":{"line":221,"column":5}},"line":187},"28":{"name":"(anonymous_28)","decl":{"start":{"line":188,"column":42},"end":{"line":188,"column":43}},"loc":{"start":{"line":188,"column":52},"end":{"line":208,"column":9}},"line":188},"29":{"name":"(anonymous_29)","decl":{"start":{"line":196,"column":43},"end":{"line":196,"column":44}},"loc":{"start":{"line":196,"column":55},"end":{"line":203,"column":13}},"line":196},"30":{"name":"(anonymous_30)","decl":{"start":{"line":204,"column":43},"end":{"line":204,"column":44}},"loc":{"start":{"line":204,"column":51},"end":{"line":207,"column":13}},"line":204},"31":{"name":"(anonymous_31)","decl":{"start":{"line":209,"column":45},"end":{"line":209,"column":46}},"loc":{"start":{"line":209,"column":55},"end":{"line":220,"column":9}},"line":209},"32":{"name":"(anonymous_32)","decl":{"start":{"line":210,"column":46},"end":{"line":210,"column":47}},"loc":{"start":{"line":210,"column":55},"end":{"line":216,"column":13}},"line":210},"33":{"name":"(anonymous_33)","decl":{"start":{"line":217,"column":43},"end":{"line":217,"column":44}},"loc":{"start":{"line":217,"column":49},"end":{"line":219,"column":13}},"line":217},"34":{"name":"(anonymous_34)","decl":{"start":{"line":222,"column":26},"end":{"line":222,"column":27}},"loc":{"start":{"line":222,"column":32},"end":{"line":253,"column":5}},"line":222},"35":{"name":"(anonymous_35)","decl":{"start":{"line":223,"column":47},"end":{"line":223,"column":48}},"loc":{"start":{"line":223,"column":57},"end":{"line":252,"column":9}},"line":223},"36":{"name":"(anonymous_36)","decl":{"start":{"line":234,"column":37},"end":{"line":234,"column":38}},"loc":{"start":{"line":234,"column":46},"end":{"line":251,"column":13}},"line":234}},"branchMap":{"0":{"loc":{"start":{"line":11,"column":8},"end":{"line":13,"column":9}},"type":"if","locations":[{"start":{"line":11,"column":8},"end":{"line":13,"column":9}},{"start":{"line":11,"column":8},"end":{"line":13,"column":9}}],"line":11},"1":{"loc":{"start":{"line":45,"column":16},"end":{"line":47,"column":17}},"type":"if","locations":[{"start":{"line":45,"column":16},"end":{"line":47,"column":17}},{"start":{"line":45,"column":16},"end":{"line":47,"column":17}}],"line":45},"2":{"loc":{"start":{"line":71,"column":16},"end":{"line":73,"column":17}},"type":"if","locations":[{"start":{"line":71,"column":16},"end":{"line":73,"column":17}},{"start":{"line":71,"column":16},"end":{"line":73,"column":17}}],"line":71},"3":{"loc":{"start":{"line":97,"column":16},"end":{"line":99,"column":17}},"type":"if","locations":[{"start":{"line":97,"column":16},"end":{"line":99,"column":17}},{"start":{"line":97,"column":16},"end":{"line":99,"column":17}}],"line":97},"4":{"loc":{"start":{"line":108,"column":16},"end":{"line":114,"column":17}},"type":"if","locations":[{"start":{"line":108,"column":16},"end":{"line":114,"column":17}},{"start":{"line":108,"column":16},"end":{"line":114,"column":17}}],"line":108},"5":{"loc":{"start":{"line":119,"column":16},"end":{"line":125,"column":17}},"type":"if","locations":[{"start":{"line":119,"column":16},"end":{"line":125,"column":17}},{"start":{"line":119,"column":16},"end":{"line":125,"column":17}}],"line":119},"6":{"loc":{"start":{"line":164,"column":16},"end":{"line":166,"column":17}},"type":"if","locations":[{"start":{"line":164,"column":16},"end":{"line":166,"column":17}},{"start":{"line":164,"column":16},"end":{"line":166,"column":17}}],"line":164},"7":{"loc":{"start":{"line":164,"column":22},"end":{"line":164,"column":43}},"type":"binary-expr","locations":[{"start":{"line":164,"column":22},"end":{"line":164,"column":25}},{"start":{"line":164,"column":29},"end":{"line":164,"column":43}}],"line":164},"8":{"loc":{"start":{"line":211,"column":16},"end":{"line":213,"column":17}},"type":"if","locations":[{"start":{"line":211,"column":16},"end":{"line":213,"column":17}},{"start":{"line":211,"column":16},"end":{"line":213,"column":17}}],"line":211},"9":{"loc":{"start":{"line":211,"column":22},"end":{"line":211,"column":43}},"type":"binary-expr","locations":[{"start":{"line":211,"column":22},"end":{"line":211,"column":25}},{"start":{"line":211,"column":29},"end":{"line":211,"column":43}}],"line":211},"10":{"loc":{"start":{"line":235,"column":16},"end":{"line":237,"column":17}},"type":"if","locations":[{"start":{"line":235,"column":16},"end":{"line":237,"column":17}},{"start":{"line":235,"column":16},"end":{"line":237,"column":17}}],"line":235}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":13,"8":13,"9":26,"10":13,"11":1,"12":1,"13":10,"14":10,"15":10,"16":10,"17":10,"18":10,"19":10,"20":10,"21":10,"22":10,"23":1,"24":10,"25":10,"26":10,"27":1,"28":1,"29":1,"30":1,"31":1,"32":0,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":0,"47":1,"48":1,"49":1,"50":1,"51":0,"52":1,"53":1,"54":1,"55":1,"56":1,"57":0,"58":1,"59":1,"60":1,"61":1,"62":1,"63":1,"64":1,"65":1,"66":1,"67":0,"68":1,"69":1,"70":1,"71":1,"72":1,"73":0,"74":1,"75":1,"76":1,"77":1,"78":1,"79":1,"80":1,"81":1,"82":1,"83":1,"84":1,"85":1,"86":1,"87":1,"88":1,"89":1,"90":0,"91":1,"92":1,"93":1,"94":1,"95":0,"96":1,"97":1,"98":1,"99":1,"100":1,"101":1,"102":1,"103":1,"104":1,"105":1,"106":1,"107":1,"108":1,"109":1,"110":1,"111":0,"112":1,"113":1,"114":1,"115":0,"116":1,"117":1,"118":1,"119":1,"120":1,"121":1,"122":0,"123":1,"124":1},"f":{"0":13,"1":26,"2":1,"3":10,"4":10,"5":10,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":0,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":0,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":0,"34":1,"35":1,"36":1},"b":{"0":[13,13],"1":[0,1],"2":[0,1],"3":[0,1],"4":[1,0],"5":[1,0],"6":[0,1],"7":[1,1],"8":[0,1],"9":[1,1],"10":[0,1]},"inputSourceMap":{"version":3,"file":"file:///home/yu23ki14/apps/henkaku/nft-karuta-backend/server/test/todo-management/todo.tests.ts","sources":["file:///home/yu23ki14/apps/henkaku/nft-karuta-backend/server/test/todo-management/todo.tests.ts"],"names":[],"mappings":"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","sourcesContent":["import { createApplication } from \"../../lib/app\";\nimport { createServer, Server } from \"http\";\nimport {\n  InMemoryTodoRepository,\n  TodoRepository,\n} from \"../../lib/todo-management/todo.repository\";\nimport { AddressInfo } from \"net\";\nimport { io, Socket } from \"socket.io-client\";\nimport { ClientEvents, ServerEvents } from \"../../lib/events\";\nimport { expect } from \"chai\";\n\nconst createPartialDone = (count: number, done: () => void) => {\n  let i = 0;\n  return () => {\n    if (++i === count) {\n      done();\n    }\n  };\n};\n\ndescribe(\"todo management\", () => {\n  let httpServer: Server,\n    socket: Socket<ServerEvents, ClientEvents>,\n    otherSocket: Socket<ServerEvents, ClientEvents>,\n    todoRepository: TodoRepository;\n\n  beforeEach((done) => {\n    const partialDone = createPartialDone(2, done);\n\n    httpServer = createServer();\n    todoRepository = new InMemoryTodoRepository();\n\n    createApplication(httpServer, {\n      todoRepository,\n    });\n\n    httpServer.listen(() => {\n      const port = (httpServer.address() as AddressInfo).port;\n      socket = io(`http://localhost:${port}`);\n      socket.on(\"connect\", partialDone);\n\n      otherSocket = io(`http://localhost:${port}`);\n      otherSocket.on(\"connect\", partialDone);\n    });\n  });\n\n  afterEach(() => {\n    httpServer.close();\n    socket.disconnect();\n    otherSocket.disconnect();\n  });\n\n  describe(\"create todo\", () => {\n    it(\"should create a todo entity\", (done) => {\n      const partialDone = createPartialDone(2, done);\n\n      socket.emit(\n        \"todo:create\",\n        {\n          title: \"lorem ipsum\",\n          completed: false,\n        },\n        async (res) => {\n          if (\"error\" in res) {\n            return done(new Error(\"should not happen\"));\n          }\n          expect(res.data).to.be.a(\"string\");\n\n          const storedEntity = await todoRepository.findById(res.data);\n          expect(storedEntity).to.eql({\n            id: res.data,\n            title: \"lorem ipsum\",\n            completed: false,\n          });\n\n          partialDone();\n        }\n      );\n\n      otherSocket.on(\"todo:created\", (todo) => {\n        expect(todo.id).to.be.a(\"string\");\n        expect(todo.title).to.eql(\"lorem ipsum\");\n        expect(todo.completed).to.eql(false);\n        partialDone();\n      });\n    });\n\n    it(\"should fail with an invalid entity\", (done) => {\n      const incompleteTodo = {\n        completed: \"false\",\n        description: true,\n      };\n      // @ts-ignore\n      socket.emit(\"todo:create\", incompleteTodo, (res) => {\n        if (!(\"error\" in res)) {\n          return done(new Error(\"should not happen\"));\n        }\n        expect(res.error).to.eql(\"invalid payload\");\n        expect(res.errorDetails).to.eql([\n          {\n            message: '\"title\" is required',\n            path: [\"title\"],\n            type: \"any.required\",\n          },\n        ]);\n        done();\n      });\n\n      otherSocket.on(\"todo:created\", () => {\n        done(new Error(\"should not happen\"));\n      });\n    });\n  });\n\n  describe(\"read todo\", () => {\n    it(\"should return a todo entity\", (done) => {\n      todoRepository.save({\n        id: \"254dbf85-f5b9-4675-b913-acab5d600884\",\n        title: \"lorem ipsum\",\n        completed: true,\n      });\n\n      socket.emit(\n        \"todo:read\",\n        \"254dbf85-f5b9-4675-b913-acab5d600884\",\n        (res) => {\n          if (\"error\" in res) {\n            return done(new Error(\"should not happen\"));\n          }\n          expect(res.data.id).to.eql(\"254dbf85-f5b9-4675-b913-acab5d600884\");\n          expect(res.data.title).to.eql(\"lorem ipsum\");\n          expect(res.data.completed).to.eql(true);\n          done();\n        }\n      );\n    });\n\n    it(\"should fail with an invalid ID\", (done) => {\n      socket.emit(\"todo:read\", \"123\", (res) => {\n        if (\"error\" in res) {\n          expect(res.error).to.eql(\"entity not found\");\n          done();\n        } else {\n          done(new Error(\"should not happen\"));\n        }\n      });\n    });\n\n    it(\"should fail with an unknown entity\", (done) => {\n      socket.emit(\n        \"todo:read\",\n        \"6edcf81e-7049-40e0-8497-9cdd52414f75\",\n        (res) => {\n          if (\"error\" in res) {\n            expect(res.error).to.eql(\"entity not found\");\n            done();\n          } else {\n            done(new Error(\"should not happen\"));\n          }\n        }\n      );\n    });\n  });\n\n  describe(\"update todo\", () => {\n    it(\"should update a todo entity\", (done) => {\n      const partialDone = createPartialDone(2, done);\n\n      todoRepository.save({\n        id: \"c7790b35-6bbb-45dd-8d67-a281ca407b43\",\n        title: \"lorem ipsum\",\n        completed: true,\n      });\n\n      socket.emit(\n        \"todo:update\",\n        {\n          id: \"c7790b35-6bbb-45dd-8d67-a281ca407b43\",\n          title: \"dolor sit amet\",\n          completed: true,\n        },\n        async () => {\n          const storedEntity = await todoRepository.findById(\n            \"c7790b35-6bbb-45dd-8d67-a281ca407b43\"\n          );\n          expect(storedEntity).to.eql({\n            id: \"c7790b35-6bbb-45dd-8d67-a281ca407b43\",\n            title: \"dolor sit amet\",\n            completed: true,\n          });\n          partialDone();\n        }\n      );\n\n      otherSocket.on(\"todo:updated\", (todo) => {\n        expect(todo.title).to.eql(\"dolor sit amet\");\n        expect(todo.completed).to.eql(true);\n        partialDone();\n      });\n    });\n\n    it(\"should fail with an invalid entity\", (done) => {\n      const incompleteTodo = {\n        id: \"123\",\n        completed: \"false\",\n        description: true,\n      };\n      // @ts-ignore\n      socket.emit(\"todo:update\", incompleteTodo, (res) => {\n        if (!(res && \"error\" in res)) {\n          return done(new Error(\"should not happen\"));\n        }\n        expect(res.error).to.eql(\"invalid payload\");\n        expect(res.errorDetails).to.eql([\n          {\n            message: '\"id\" must be a valid GUID',\n            path: [\"id\"],\n            type: \"string.guid\",\n          },\n          {\n            message: '\"title\" is required',\n            path: [\"title\"],\n            type: \"any.required\",\n          },\n        ]);\n        done();\n      });\n\n      otherSocket.on(\"todo:updated\", () => {\n        done(new Error(\"should not happen\"));\n      });\n    });\n  });\n\n  describe(\"delete todo\", () => {\n    it(\"should delete a todo entity\", (done) => {\n      const partialDone = createPartialDone(2, done);\n      const id = \"58960ab2-4e78-4ced-8079-134f12179d46\";\n\n      todoRepository.save({\n        id,\n        title: \"lorem ipsum\",\n        completed: true,\n      });\n\n      socket.emit(\"todo:delete\", id, async () => {\n        try {\n          await todoRepository.findById(id);\n        } catch (e) {\n          partialDone();\n        }\n      });\n\n      otherSocket.on(\"todo:deleted\", (id) => {\n        expect(id).to.eql(\"58960ab2-4e78-4ced-8079-134f12179d46\");\n        partialDone();\n      });\n    });\n\n    it(\"should fail with an invalid ID\", (done) => {\n      socket.emit(\"todo:delete\", \"123\", (res) => {\n        if (!(res && \"error\" in res)) {\n          return done(new Error(\"should not happen\"));\n        }\n        expect(res.error).to.eql(\"entity not found\");\n        done();\n      });\n\n      otherSocket.on(\"todo:deleted\", () => {\n        done(new Error(\"should not happen\"));\n      });\n    });\n  });\n\n  describe(\"list todo\", () => {\n    it(\"should return a list of entities\", (done) => {\n      todoRepository.save({\n        id: \"d445db6d-9d55-4ff2-88ae-bd1f81c299d2\",\n        title: \"lorem ipsum\",\n        completed: false,\n      });\n\n      todoRepository.save({\n        id: \"5f56fb59-a887-4984-93bf-eb39b4170a35\",\n        title: \"dolor sit amet\",\n        completed: true,\n      });\n\n      socket.emit(\"todo:list\", (res) => {\n        if (\"error\" in res) {\n          return done(new Error(\"should not happen\"));\n        }\n        expect(res.data).to.eql([\n          {\n            id: \"d445db6d-9d55-4ff2-88ae-bd1f81c299d2\",\n            title: \"lorem ipsum\",\n            completed: false,\n          },\n          {\n            id: \"5f56fb59-a887-4984-93bf-eb39b4170a35\",\n            title: \"dolor sit amet\",\n            completed: true,\n          },\n        ]);\n        done();\n      });\n    });\n  });\n});\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f31d6aec0cf6740db2aa53abef2a89b8877cb417","contentHash":"e87401085f84e04898fd668719c62b9a208d8478d76aaeef7765245240d1d683"},"/home/yu23ki14/apps/henkaku/nft-karuta-backend/server/lib/app.ts":{"path":"/home/yu23ki14/apps/henkaku/nft-karuta-backend/server/lib/app.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":35}},"2":{"start":{"line":4,"column":20},"end":{"line":4,"column":40}},"3":{"start":{"line":5,"column":24},"end":{"line":5,"column":66}},"4":{"start":{"line":7,"column":15},"end":{"line":7,"column":64}},"5":{"start":{"line":8,"column":72},"end":{"line":8,"column":112}},"6":{"start":{"line":9,"column":4},"end":{"line":15,"column":7}},"7":{"start":{"line":10,"column":8},"end":{"line":10,"column":45}},"8":{"start":{"line":11,"column":8},"end":{"line":11,"column":41}},"9":{"start":{"line":12,"column":8},"end":{"line":12,"column":45}},"10":{"start":{"line":13,"column":8},"end":{"line":13,"column":45}},"11":{"start":{"line":14,"column":8},"end":{"line":14,"column":41}},"12":{"start":{"line":16,"column":4},"end":{"line":16,"column":14}},"13":{"start":{"line":18,"column":0},"end":{"line":18,"column":46}}},"fnMap":{"0":{"name":"createApplication","decl":{"start":{"line":6,"column":9},"end":{"line":6,"column":26}},"loc":{"start":{"line":6,"column":71},"end":{"line":17,"column":1}},"line":6},"1":{"name":"(anonymous_1)","decl":{"start":{"line":9,"column":24},"end":{"line":9,"column":25}},"loc":{"start":{"line":9,"column":36},"end":{"line":15,"column":5}},"line":9}},"branchMap":{"0":{"loc":{"start":{"line":6,"column":51},"end":{"line":6,"column":69}},"type":"default-arg","locations":[{"start":{"line":6,"column":67},"end":{"line":6,"column":69}}],"line":6}},"s":{"0":1,"1":1,"2":1,"3":1,"4":10,"5":10,"6":10,"7":20,"8":20,"9":20,"10":20,"11":20,"12":10,"13":1},"f":{"0":10,"1":20},"b":{"0":[10]},"inputSourceMap":{"version":3,"file":"file:///home/yu23ki14/apps/henkaku/nft-karuta-backend/server/lib/app.ts","sources":["file:///home/yu23ki14/apps/henkaku/nft-karuta-backend/server/lib/app.ts"],"names":[],"mappings":";;;AACA,yCAAkD;AAGlD,mEAAiE;AAMjE,SAAgB,iBAAiB,CAC/B,UAAsB,EACtB,UAAsB,EACtB,gBAAwC,EAAE;IAE1C,MAAM,EAAE,GAAG,IAAI,kBAAM,CAA6B,UAAU,EAAE,aAAa,CAAC,CAAC;IAE7E,MAAM,EACJ,UAAU,EACV,QAAQ,EACR,UAAU,EACV,UAAU,EACV,QAAQ,GACT,GAAG,IAAA,uBAAkB,EAAC,UAAU,CAAC,CAAC;IAEnC,EAAE,CAAC,EAAE,CAAC,YAAY,EAAE,CAAC,MAAM,EAAE,EAAE;QAC7B,MAAM,CAAC,EAAE,CAAC,aAAa,EAAE,UAAU,CAAC,CAAC;QACrC,MAAM,CAAC,EAAE,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;QACjC,MAAM,CAAC,EAAE,CAAC,aAAa,EAAE,UAAU,CAAC,CAAC;QACrC,MAAM,CAAC,EAAE,CAAC,aAAa,EAAE,UAAU,CAAC,CAAC;QACrC,MAAM,CAAC,EAAE,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;IACnC,CAAC,CAAC,CAAC;IAEH,OAAO,EAAE,CAAC;AACZ,CAAC;AAxBD,8CAwBC","sourcesContent":["import { Server as HttpServer } from \"http\";\nimport { Server, ServerOptions } from \"socket.io\";\nimport { ClientEvents, ServerEvents } from \"./events\";\nimport { TodoRepository } from \"./todo-management/todo.repository\";\nimport createTodoHandlers from \"./todo-management/todo.handlers\";\n\nexport interface Components {\n  todoRepository: TodoRepository;\n}\n\nexport function createApplication(\n  httpServer: HttpServer,\n  components: Components,\n  serverOptions: Partial<ServerOptions> = {}\n): Server<ClientEvents, ServerEvents> {\n  const io = new Server<ClientEvents, ServerEvents>(httpServer, serverOptions);\n\n  const {\n    createTodo,\n    readTodo,\n    updateTodo,\n    deleteTodo,\n    listTodo,\n  } = createTodoHandlers(components);\n\n  io.on(\"connection\", (socket) => {\n    socket.on(\"todo:create\", createTodo);\n    socket.on(\"todo:read\", readTodo);\n    socket.on(\"todo:update\", updateTodo);\n    socket.on(\"todo:delete\", deleteTodo);\n    socket.on(\"todo:list\", listTodo);\n  });\n\n  return io;\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"5fd4c3cd0fb957225f45e734b2b3d3160e0adf2e","contentHash":"33b0e2e77cec2f9529f6e0609e3656118c06e35767df762647696d5814d4522f"},"/home/yu23ki14/apps/henkaku/nft-karuta-backend/server/lib/todo-management/todo.handlers.ts":{"path":"/home/yu23ki14/apps/henkaku/nft-karuta-backend/server/lib/todo-management/todo.handlers.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":15},"end":{"line":3,"column":33}},"2":{"start":{"line":4,"column":15},"end":{"line":4,"column":30}},"3":{"start":{"line":5,"column":12},"end":{"line":5,"column":26}},"4":{"start":{"line":6,"column":17},"end":{"line":8,"column":2}},"5":{"start":{"line":9,"column":19},"end":{"line":16,"column":2}},"6":{"start":{"line":11,"column":28},"end":{"line":11,"column":46}},"7":{"start":{"line":12,"column":28},"end":{"line":12,"column":45}},"8":{"start":{"line":18,"column":31},"end":{"line":18,"column":41}},"9":{"start":{"line":19,"column":4},"end":{"line":126,"column":6}},"10":{"start":{"line":22,"column":27},"end":{"line":22,"column":31}},"11":{"start":{"line":24,"column":37},"end":{"line":27,"column":14}},"12":{"start":{"line":28,"column":12},"end":{"line":33,"column":13}},"13":{"start":{"line":29,"column":16},"end":{"line":32,"column":19}},"14":{"start":{"line":34,"column":12},"end":{"line":34,"column":40}},"15":{"start":{"line":36,"column":12},"end":{"line":43,"column":13}},"16":{"start":{"line":37,"column":16},"end":{"line":37,"column":49}},"17":{"start":{"line":40,"column":16},"end":{"line":42,"column":19}},"18":{"start":{"line":45,"column":12},"end":{"line":47,"column":15}},"19":{"start":{"line":49,"column":12},"end":{"line":49,"column":57}},"20":{"start":{"line":52,"column":30},"end":{"line":52,"column":51}},"21":{"start":{"line":53,"column":12},"end":{"line":57,"column":13}},"22":{"start":{"line":54,"column":16},"end":{"line":56,"column":19}},"23":{"start":{"line":58,"column":12},"end":{"line":68,"column":13}},"24":{"start":{"line":59,"column":29},"end":{"line":59,"column":62}},"25":{"start":{"line":60,"column":16},"end":{"line":62,"column":19}},"26":{"start":{"line":65,"column":16},"end":{"line":67,"column":19}},"27":{"start":{"line":72,"column":27},"end":{"line":72,"column":31}},"28":{"start":{"line":73,"column":37},"end":{"line":76,"column":14}},"29":{"start":{"line":77,"column":12},"end":{"line":82,"column":13}},"30":{"start":{"line":78,"column":16},"end":{"line":81,"column":19}},"31":{"start":{"line":83,"column":12},"end":{"line":90,"column":13}},"32":{"start":{"line":84,"column":16},"end":{"line":84,"column":49}},"33":{"start":{"line":87,"column":16},"end":{"line":89,"column":19}},"34":{"start":{"line":91,"column":12},"end":{"line":91,"column":23}},"35":{"start":{"line":92,"column":12},"end":{"line":92,"column":57}},"36":{"start":{"line":96,"column":27},"end":{"line":96,"column":31}},"37":{"start":{"line":97,"column":30},"end":{"line":97,"column":51}},"38":{"start":{"line":98,"column":12},"end":{"line":102,"column":13}},"39":{"start":{"line":99,"column":16},"end":{"line":101,"column":19}},"40":{"start":{"line":103,"column":12},"end":{"line":110,"column":13}},"41":{"start":{"line":104,"column":16},"end":{"line":104,"column":52}},"42":{"start":{"line":107,"column":16},"end":{"line":109,"column":19}},"43":{"start":{"line":111,"column":12},"end":{"line":111,"column":23}},"44":{"start":{"line":112,"column":12},"end":{"line":112,"column":54}},"45":{"start":{"line":115,"column":12},"end":{"line":124,"column":13}},"46":{"start":{"line":116,"column":16},"end":{"line":118,"column":19}},"47":{"start":{"line":121,"column":16},"end":{"line":123,"column":19}},"48":{"start":{"line":128,"column":0},"end":{"line":128,"column":28}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":11,"column":16},"end":{"line":11,"column":17}},"loc":{"start":{"line":11,"column":28},"end":{"line":11,"column":46}},"line":11},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":16},"end":{"line":12,"column":17}},"loc":{"start":{"line":12,"column":28},"end":{"line":12,"column":45}},"line":12},"2":{"name":"default_1","decl":{"start":{"line":17,"column":9},"end":{"line":17,"column":18}},"loc":{"start":{"line":17,"column":31},"end":{"line":127,"column":1}},"line":17},"3":{"name":"(anonymous_3)","decl":{"start":{"line":20,"column":20},"end":{"line":20,"column":21}},"loc":{"start":{"line":20,"column":55},"end":{"line":50,"column":9}},"line":20},"4":{"name":"(anonymous_4)","decl":{"start":{"line":51,"column":18},"end":{"line":51,"column":19}},"loc":{"start":{"line":51,"column":48},"end":{"line":69,"column":9}},"line":51},"5":{"name":"(anonymous_5)","decl":{"start":{"line":70,"column":20},"end":{"line":70,"column":21}},"loc":{"start":{"line":70,"column":55},"end":{"line":93,"column":9}},"line":70},"6":{"name":"(anonymous_6)","decl":{"start":{"line":94,"column":20},"end":{"line":94,"column":21}},"loc":{"start":{"line":94,"column":50},"end":{"line":113,"column":9}},"line":94},"7":{"name":"(anonymous_7)","decl":{"start":{"line":114,"column":18},"end":{"line":114,"column":19}},"loc":{"start":{"line":114,"column":44},"end":{"line":125,"column":9}},"line":114}},"branchMap":{"0":{"loc":{"start":{"line":28,"column":12},"end":{"line":33,"column":13}},"type":"if","locations":[{"start":{"line":28,"column":12},"end":{"line":33,"column":13}},{"start":{"line":28,"column":12},"end":{"line":33,"column":13}}],"line":28},"1":{"loc":{"start":{"line":53,"column":12},"end":{"line":57,"column":13}},"type":"if","locations":[{"start":{"line":53,"column":12},"end":{"line":57,"column":13}},{"start":{"line":53,"column":12},"end":{"line":57,"column":13}}],"line":53},"2":{"loc":{"start":{"line":77,"column":12},"end":{"line":82,"column":13}},"type":"if","locations":[{"start":{"line":77,"column":12},"end":{"line":82,"column":13}},{"start":{"line":77,"column":12},"end":{"line":82,"column":13}}],"line":77},"3":{"loc":{"start":{"line":98,"column":12},"end":{"line":102,"column":13}},"type":"if","locations":[{"start":{"line":98,"column":12},"end":{"line":102,"column":13}},{"start":{"line":98,"column":12},"end":{"line":102,"column":13}}],"line":98}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":2,"7":2,"8":10,"9":10,"10":2,"11":2,"12":2,"13":1,"14":1,"15":1,"16":1,"17":0,"18":1,"19":1,"20":3,"21":3,"22":1,"23":2,"24":2,"25":1,"26":1,"27":2,"28":2,"29":2,"30":1,"31":1,"32":1,"33":0,"34":1,"35":1,"36":2,"37":2,"38":2,"39":1,"40":1,"41":1,"42":0,"43":1,"44":1,"45":1,"46":1,"47":0,"48":1},"f":{"0":2,"1":2,"2":10,"3":2,"4":3,"5":2,"6":2,"7":1},"b":{"0":[1,1],"1":[1,2],"2":[1,1],"3":[1,1]},"inputSourceMap":{"version":3,"file":"file:///home/yu23ki14/apps/henkaku/nft-karuta-backend/server/lib/todo-management/todo.handlers.ts","sources":["file:///home/yu23ki14/apps/henkaku/nft-karuta-backend/server/lib/todo-management/todo.handlers.ts"],"names":[],"mappings":"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","sourcesContent":["import { Errors, mapErrorDetails, sanitizeErrorMessage } from \"../util\";\nimport { v4 as uuid } from \"uuid\";\nimport { Components } from \"../app\";\nimport Joi = require(\"joi\");\nimport { Todo, TodoID } from \"./todo.repository\";\nimport { ClientEvents, Response, ServerEvents } from \"../events\";\nimport { Socket } from \"socket.io\";\n\nconst idSchema = Joi.string().guid({\n  version: \"uuidv4\",\n});\n\nconst todoSchema = Joi.object({\n  id: idSchema.alter({\n    create: (schema) => schema.forbidden(),\n    update: (schema) => schema.required(),\n  }),\n  title: Joi.string().max(256).required(),\n  completed: Joi.boolean().required(),\n});\n\nexport default function (components: Components) {\n  const { todoRepository } = components;\n  return {\n    createTodo: async function (\n      payload: Omit<Todo, \"id\">,\n      callback: (res: Response<TodoID>) => void\n    ) {\n      // @ts-ignore\n      const socket: Socket<ClientEvents, ServerEvents> = this;\n\n      // validate the payload\n      const { error, value } = todoSchema.tailor(\"create\").validate(payload, {\n        abortEarly: false,\n        stripUnknown: true,\n      });\n\n      if (error) {\n        return callback({\n          error: Errors.INVALID_PAYLOAD,\n          errorDetails: mapErrorDetails(error.details),\n        });\n      }\n\n      value.id = uuid();\n\n      // persist the entity\n      try {\n        await todoRepository.save(value);\n      } catch (e) {\n        return callback({\n          error: sanitizeErrorMessage(e),\n        });\n      }\n\n      // acknowledge the creation\n      callback({\n        data: value.id,\n      });\n\n      // notify the other users\n      socket.broadcast.emit(\"todo:created\", value);\n    },\n\n    readTodo: async function (\n      id: TodoID,\n      callback: (res: Response<Todo>) => void\n    ) {\n      const { error } = idSchema.validate(id);\n\n      if (error) {\n        return callback({\n          error: Errors.ENTITY_NOT_FOUND,\n        });\n      }\n\n      try {\n        const todo = await todoRepository.findById(id);\n        callback({\n          data: todo,\n        });\n      } catch (e) {\n        callback({\n          error: sanitizeErrorMessage(e),\n        });\n      }\n    },\n\n    updateTodo: async function (\n      payload: Todo,\n      callback: (res?: Response<void>) => void\n    ) {\n      // @ts-ignore\n      const socket: Socket<ClientEvents, ServerEvents> = this;\n\n      const { error, value } = todoSchema.tailor(\"update\").validate(payload, {\n        abortEarly: false,\n        stripUnknown: true,\n      });\n\n      if (error) {\n        return callback({\n          error: Errors.INVALID_PAYLOAD,\n          errorDetails: mapErrorDetails(error.details),\n        });\n      }\n\n      try {\n        await todoRepository.save(value);\n      } catch (e) {\n        return callback({\n          error: sanitizeErrorMessage(e),\n        });\n      }\n\n      callback();\n      socket.broadcast.emit(\"todo:updated\", value);\n    },\n\n    deleteTodo: async function (\n      id: TodoID,\n      callback: (res?: Response<void>) => void\n    ) {\n      // @ts-ignore\n      const socket: Socket<ClientEvents, ServerEvents> = this;\n\n      const { error } = idSchema.validate(id);\n\n      if (error) {\n        return callback({\n          error: Errors.ENTITY_NOT_FOUND,\n        });\n      }\n\n      try {\n        await todoRepository.deleteById(id);\n      } catch (e) {\n        return callback({\n          error: sanitizeErrorMessage(e),\n        });\n      }\n\n      callback();\n      socket.broadcast.emit(\"todo:deleted\", id);\n    },\n\n    listTodo: async function (callback: (res: Response<Todo[]>) => void) {\n      try {\n        callback({\n          data: await todoRepository.findAll(),\n        });\n      } catch (e) {\n        callback({\n          error: sanitizeErrorMessage(e),\n        });\n      }\n    },\n  };\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c4cb2b7047ccfe00c5c70f97849b50becc8d2b3b","contentHash":"6868ac248bb4091422a907db2ea211ee6d2688a6f3478d6f44c54755a1e36643"},"/home/yu23ki14/apps/henkaku/nft-karuta-backend/server/lib/util.ts":{"path":"/home/yu23ki14/apps/henkaku/nft-karuta-backend/server/lib/util.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":81}},"2":{"start":{"line":5,"column":0},"end":{"line":8,"column":53}},"3":{"start":{"line":6,"column":4},"end":{"line":6,"column":52}},"4":{"start":{"line":7,"column":4},"end":{"line":7,"column":50}},"5":{"start":{"line":9,"column":20},"end":{"line":9,"column":41}},"6":{"start":{"line":11,"column":4},"end":{"line":16,"column":5}},"7":{"start":{"line":12,"column":8},"end":{"line":12,"column":23}},"8":{"start":{"line":15,"column":8},"end":{"line":15,"column":47}},"9":{"start":{"line":18,"column":0},"end":{"line":18,"column":52}},"10":{"start":{"line":20,"column":4},"end":{"line":24,"column":8}},"11":{"start":{"line":20,"column":34},"end":{"line":24,"column":5}},"12":{"start":{"line":26,"column":0},"end":{"line":26,"column":42}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":5,"column":1},"end":{"line":5,"column":2}},"loc":{"start":{"line":5,"column":19},"end":{"line":8,"column":1}},"line":5},"1":{"name":"sanitizeErrorMessage","decl":{"start":{"line":10,"column":9},"end":{"line":10,"column":29}},"loc":{"start":{"line":10,"column":39},"end":{"line":17,"column":1}},"line":10},"2":{"name":"mapErrorDetails","decl":{"start":{"line":19,"column":9},"end":{"line":19,"column":24}},"loc":{"start":{"line":19,"column":34},"end":{"line":25,"column":1}},"line":19},"3":{"name":"(anonymous_3)","decl":{"start":{"line":20,"column":23},"end":{"line":20,"column":24}},"loc":{"start":{"line":20,"column":34},"end":{"line":24,"column":5}},"line":20}},"branchMap":{"0":{"loc":{"start":{"line":8,"column":12},"end":{"line":8,"column":51}},"type":"binary-expr","locations":[{"start":{"line":8,"column":12},"end":{"line":8,"column":26}},{"start":{"line":8,"column":31},"end":{"line":8,"column":50}}],"line":8},"1":{"loc":{"start":{"line":11,"column":4},"end":{"line":16,"column":5}},"type":"if","locations":[{"start":{"line":11,"column":4},"end":{"line":16,"column":5}},{"start":{"line":11,"column":4},"end":{"line":16,"column":5}}],"line":11},"2":{"loc":{"start":{"line":11,"column":8},"end":{"line":11,"column":68}},"type":"binary-expr","locations":[{"start":{"line":11,"column":8},"end":{"line":11,"column":35}},{"start":{"line":11,"column":39},"end":{"line":11,"column":68}}],"line":11}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":0,"9":1,"10":2,"11":3,"12":1},"f":{"0":1,"1":1,"2":2,"3":3},"b":{"0":[1,1],"1":[1,0],"2":[1,1]},"inputSourceMap":{"version":3,"file":"file:///home/yu23ki14/apps/henkaku/nft-karuta-backend/server/lib/util.ts","sources":["file:///home/yu23ki14/apps/henkaku/nft-karuta-backend/server/lib/util.ts"],"names":[],"mappings":";;;AAEA,IAAY,MAGX;AAHD,WAAY,MAAM;IAChB,+CAAqC,CAAA;IACrC,6CAAmC,CAAA;AACrC,CAAC,EAHW,MAAM,GAAN,cAAM,KAAN,cAAM,QAGjB;AAED,MAAM,WAAW,GAAa,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;AAEpD,SAAgB,oBAAoB,CAAC,OAAY;IAC/C,IAAI,OAAO,OAAO,KAAK,QAAQ,IAAI,WAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE;QAChE,OAAO,OAAO,CAAC;KAChB;SAAM;QACL,OAAO,+BAA+B,CAAC;KACxC;AACH,CAAC;AAND,oDAMC;AAED,SAAgB,eAAe,CAAC,OAA8B;IAC5D,OAAO,OAAO,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;QAC5B,OAAO,EAAE,IAAI,CAAC,OAAO;QACrB,IAAI,EAAE,IAAI,CAAC,IAAI;QACf,IAAI,EAAE,IAAI,CAAC,IAAI;KAChB,CAAC,CAAC,CAAC;AACN,CAAC;AAND,0CAMC","sourcesContent":["import { ValidationErrorItem } from \"joi\";\n\nexport enum Errors {\n  ENTITY_NOT_FOUND = \"entity not found\",\n  INVALID_PAYLOAD = \"invalid payload\",\n}\n\nconst errorValues: string[] = Object.values(Errors);\n\nexport function sanitizeErrorMessage(message: any) {\n  if (typeof message === \"string\" && errorValues.includes(message)) {\n    return message;\n  } else {\n    return \"an unknown error has occurred\";\n  }\n}\n\nexport function mapErrorDetails(details: ValidationErrorItem[]) {\n  return details.map((item) => ({\n    message: item.message,\n    path: item.path,\n    type: item.type,\n  }));\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"190ee3be4305e480992b7ace98e8f0bff1c7ba94","contentHash":"fd80c69c72f8e2836a02469311b1edf8b8131781e49b61352ada36807dc436d1"},"/home/yu23ki14/apps/henkaku/nft-karuta-backend/server/lib/todo-management/todo.repository.ts":{"path":"/home/yu23ki14/apps/henkaku/nft-karuta-backend/server/lib/todo-management/todo.repository.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":65}},"2":{"start":{"line":4,"column":15},"end":{"line":4,"column":33}},"3":{"start":{"line":9,"column":0},"end":{"line":9,"column":40}},"4":{"start":{"line":12,"column":8},"end":{"line":12,"column":28}},"5":{"start":{"line":13,"column":8},"end":{"line":13,"column":31}},"6":{"start":{"line":16,"column":25},"end":{"line":16,"column":56}},"7":{"start":{"line":17,"column":8},"end":{"line":17,"column":41}},"8":{"start":{"line":20,"column":8},"end":{"line":25,"column":9}},"9":{"start":{"line":21,"column":12},"end":{"line":21,"column":55}},"10":{"start":{"line":24,"column":12},"end":{"line":24,"column":66}},"11":{"start":{"line":28,"column":8},"end":{"line":28,"column":42}},"12":{"start":{"line":29,"column":8},"end":{"line":29,"column":33}},"13":{"start":{"line":32,"column":24},"end":{"line":32,"column":45}},"14":{"start":{"line":33,"column":8},"end":{"line":38,"column":9}},"15":{"start":{"line":34,"column":12},"end":{"line":34,"column":37}},"16":{"start":{"line":37,"column":12},"end":{"line":37,"column":66}},"17":{"start":{"line":41,"column":0},"end":{"line":41,"column":56}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":11,"column":4},"end":{"line":11,"column":5}},"loc":{"start":{"line":11,"column":18},"end":{"line":14,"column":5}},"line":11},"1":{"name":"(anonymous_1)","decl":{"start":{"line":15,"column":4},"end":{"line":15,"column":5}},"loc":{"start":{"line":15,"column":14},"end":{"line":18,"column":5}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":19,"column":4},"end":{"line":19,"column":5}},"loc":{"start":{"line":19,"column":17},"end":{"line":26,"column":5}},"line":19},"3":{"name":"(anonymous_3)","decl":{"start":{"line":27,"column":4},"end":{"line":27,"column":5}},"loc":{"start":{"line":27,"column":17},"end":{"line":30,"column":5}},"line":27},"4":{"name":"(anonymous_4)","decl":{"start":{"line":31,"column":4},"end":{"line":31,"column":5}},"loc":{"start":{"line":31,"column":19},"end":{"line":39,"column":5}},"line":31}},"branchMap":{"0":{"loc":{"start":{"line":20,"column":8},"end":{"line":25,"column":9}},"type":"if","locations":[{"start":{"line":20,"column":8},"end":{"line":25,"column":9}},{"start":{"line":20,"column":8},"end":{"line":25,"column":9}}],"line":20},"1":{"loc":{"start":{"line":33,"column":8},"end":{"line":38,"column":9}},"type":"if","locations":[{"start":{"line":33,"column":8},"end":{"line":38,"column":9}},{"start":{"line":33,"column":8},"end":{"line":38,"column":9}}],"line":33}},"s":{"0":1,"1":1,"2":1,"3":1,"4":10,"5":10,"6":1,"7":1,"8":5,"9":3,"10":2,"11":7,"12":7,"13":1,"14":1,"15":1,"16":0,"17":1},"f":{"0":10,"1":1,"2":5,"3":7,"4":1},"b":{"0":[3,2],"1":[1,0]},"inputSourceMap":{"version":3,"file":"file:///home/yu23ki14/apps/henkaku/nft-karuta-backend/server/lib/todo-management/todo.repository.ts","sources":["file:///home/yu23ki14/apps/henkaku/nft-karuta-backend/server/lib/todo-management/todo.repository.ts"],"names":[],"mappings":";;;AAAA,kCAAiC;AAEjC,MAAe,cAAc;CAK5B;AAUD,MAAsB,cAAe,SAAQ,cAA4B;CAAG;AAA5E,wCAA4E;AAE5E,MAAa,sBAAuB,SAAQ,cAAc;IAA1D;;QACmB,UAAK,GAAsB,IAAI,GAAG,EAAE,CAAC;IA4BxD,CAAC;IA1BC,OAAO;QACL,MAAM,QAAQ,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,CAAC;QACjD,OAAO,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;IACnC,CAAC;IAED,QAAQ,CAAC,EAAU;QACjB,IAAI,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE;YACtB,OAAO,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAAE,CAAC,CAAC;SAC7C;aAAM;YACL,OAAO,OAAO,CAAC,MAAM,CAAC,aAAM,CAAC,gBAAgB,CAAC,CAAC;SAChD;IACH,CAAC;IAED,IAAI,CAAC,MAAY;QACf,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC;QAClC,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;IAC3B,CAAC;IAED,UAAU,CAAC,EAAU;QACnB,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;QACtC,IAAI,OAAO,EAAE;YACX,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;SAC1B;aAAM;YACL,OAAO,OAAO,CAAC,MAAM,CAAC,aAAM,CAAC,gBAAgB,CAAC,CAAC;SAChD;IACH,CAAC;CACF;AA7BD,wDA6BC","sourcesContent":["import { Errors } from \"../util\";\n\nabstract class CrudRepository<T, ID> {\n  abstract findAll(): Promise<T[]>;\n  abstract findById(id: ID): Promise<T>;\n  abstract save(entity: T): Promise<void>;\n  abstract deleteById(id: ID): Promise<void>;\n}\n\nexport type TodoID = string;\n\nexport interface Todo {\n  id: TodoID;\n  completed: boolean;\n  title: string;\n}\n\nexport abstract class TodoRepository extends CrudRepository<Todo, TodoID> {}\n\nexport class InMemoryTodoRepository extends TodoRepository {\n  private readonly todos: Map<TodoID, Todo> = new Map();\n\n  findAll(): Promise<Todo[]> {\n    const entities = Array.from(this.todos.values());\n    return Promise.resolve(entities);\n  }\n\n  findById(id: TodoID): Promise<Todo> {\n    if (this.todos.has(id)) {\n      return Promise.resolve(this.todos.get(id)!);\n    } else {\n      return Promise.reject(Errors.ENTITY_NOT_FOUND);\n    }\n  }\n\n  save(entity: Todo): Promise<void> {\n    this.todos.set(entity.id, entity);\n    return Promise.resolve();\n  }\n\n  deleteById(id: TodoID): Promise<void> {\n    const deleted = this.todos.delete(id);\n    if (deleted) {\n      return Promise.resolve();\n    } else {\n      return Promise.reject(Errors.ENTITY_NOT_FOUND);\n    }\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2f44ae4046caa7798454b9d125bd731bb09f4eb8","contentHash":"331faf7d0cfc78bf28bb7acd70051c2737dd3a5bfc65fb5336d93c8eb91e5627"}}